想定ケース
- Aさんの現在の口座残高が500円
- Aさんは300円を引き出したい
- クレジットカードは300円を引き落としたい

```plantuml
@startuml
actor Aさん as T1
database 銀行口座A as DB
actor クレジットカード会社 as T2

autonumber

T1 -> DB: トランザクション1を開始する
T1 -> DB: 口座Aの残高を読み込む
DB -> DB++: 共有ロック1を取得\n2相ロックの1相目
DB --> T1: 残高: 500円
T2 -> DB: トランザクション2を開始する
T2 -> DB: 口座Aの残高を読み込む
DB -> DB++: 共有ロック2を取得\n2相ロックの1相目
DB --> T2: 残高: 500円
note left of T2
  300円を引き落とす
  200円=500円-300円
end note
T2 -> DB: 口座Aの残高を200円に更新する
DB --> T2: 共有ロック1の解放待ち\n専有ロック2を取得予定
T2 -> T2: 待機
note right of T1
  300円を引き落とす
  200円=500円-300円
end note
T1 -> DB: 口座Aの残高を200円に更新する
DB --> T1: 共有ロック2の解放待ち\n専有ロック1を取得予定
T1 -> T1: 待機
@enduml
```

結果、デッドロックが発生しました(あまり良い例ではなかったかもしれないが、ノンリピータブルリードは防げた)
この後は、いずれかのトランザクションがロールバックして、整合性が取れた状態になる。なお、ロールバックするトランザクションはデッドロック解除の方式に依る。