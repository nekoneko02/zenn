---
title: "SageMakerで、全リソース削除しても請求が止まらないされる罠:
\"Amazon SageMaker CreateVolume-Gp3\""
emoji: "👌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS", "SageMaker"]
published: true
---
# 概要
SageMakerを利用していたときに、身に覚えのない課金に困ったので、その体験を共有します。この後に請求書の詳細を記載しますが、約14ドル/月の請求がされてしまいました。

状況としては以下の通りです：

- 個人学習のためにSageMakerを利用（ハンズオン）していた。
- 終わった後に、全リソースを消した（つもり）。
- AWSからの請求が止まらず困った。

簡単に言うと、**SageMakerのドメインを消しただけでは請求は止まらない**[^1]ということです。

なお、SageMaker関連で多額（数万円~十万円）の請求がされた話は、色々な方が経験しているようです。一方で本記事では、"リソースを消したつもりなのに請求が止まらない"状況に絞って記載しています（本記事の最後に、多額請求系の記事へのリンクも載せておきます。）

私の場合は、合計で30ドルほど無駄な課金となってしまいました…

[^1]: 2024/02/09時点の仕様。さすがに不親切な仕様なので、いずれ修正されるかもしれません。

# 対象読者

- SageMakerを使ってみたら、不明な課金が止まらない人

# 結論
最初にどんな請求書の内容だったか、その課金は何だったのか（どう課金を止めるか）を説明します。その後に（おまけとして）、"SageMakerの全リソースを消したつもり"に至った手順・経緯を記載します。

なお、課金の原因が同じとは限らないため、**最終的に課金が止まったことを確認すること**を強く推奨します。

## 請求書の内容
請求書の内容は以下の通りです。

> |説明|使用量|金額 USD|
> |--|--|--|
> |Amazon SageMaker CreateVolume-Gp3||USD 14.11|
> |$0.1344 per GB-Mo of provisioned ML storage| 105 GB-Mo|USD 14.11|

![invoice_sagemaker](/images/invoice_sagemaker.png)


## 請求を止める方法
上記の請求は、**Amazon EFS（Elastic File System）**[^2]に対する請求です。

消し方は簡単で、AWSのマネジメントコンソール > EFSの管理画面で、EFSの削除ができます。EFSや削除方法の詳細は、以下の公式ページを参照ください：
https://docs.aws.amazon.com/ja_jp/efs/latest/ug/delete-efs-fs.html

（請求書に「EFS」と書いていないのは、なかなか罠だと思います…）

[^2]: ストレージサービス。ドメインをクイックセットアップ[^3]で作成した場合に作成されている

## 補足
他にもS3のバケットやCloudWatch Logsにデータが残っていました。

無料枠のおかげで、（私の場合は）課金されませんでしたが、こちらのリソースも必要ないなら全削除しておくとよいと思います。

# 【おまけ】SageMakerのドメイン削除では足りない！
おまけパートです。私が"SageMakerの全リソースを消したつもり"になった経緯をまとめます。

課金が発生した時点で、「最初にドメインを作ったせいだろう。ドメインを削除すれば課金が止まるだろう。」と考えました。これが間違いでした。
## 手順
どんな経緯・手順で、本記事の事象に至ったかを説明していきます。
### 1. SageMakerを使い始める。
ハンズオンをするために、SageMakerを使い始めました。

SageMakerを初めて使うには、最初にドメインを作成する必要があります。ドメインはクイックセットアップ[^3]を利用して作成しました。

[^3]:https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/onboard-quick-start.html
### 2. ハンズオンが終わったので、SageMakerのリソースを削除する。
ハンズオンが終わったので、無駄な課金が発生しないようにSageMaker関連のリソースを削除していきました。

この段階で削除したリソースは以下だったと思います：

- トレーニングジョブや推論エンドポイント
  - ドメインの詳細画面の「リソース」タブから確認できます。
  - ちなみに、これらは比較的料金が高いです。高額請求された話は、このリソース関連が大半だと思います。
- ユーザープロファイル
  - これを消さないと「ドメインを削除」ボタンが押せないため、削除が必要です。
- ドメイン
  - 先ほど書いた通り、ドメインを消しました。

そして、ドメイン消したので課金も止まるだろうと思い、放置してしまいました。（同じように思う人も多い気がしますが…）

### 3. いつの間にか課金が発生している。
ここが本記事の本文にあたる部分です。ドメインを消したから課金は発生しないだろうと思っていました。ところが請求書を見てみると課金が続いているのです。

前半に書いた通り、原因はEFSに対する課金でした。しかし、調べても全然情報が出てきません。結局1ヶ月以上わからず、課金が続いてしまいました。

# まとめ
今回は、SageMakerを利用した際に課金が止まらなくて困った話を書きました。そして、原因はEFSが自動で作成されていたことでした。

AWSあるあるかもですが、課金体系がわかりにくいです。しかも、サービスが多すぎる（サービスが多いのは良いことではありますが）。ドメインのクイックセットアップは、かなり便利です。ですがその反面、様々なリソースが勝手に作成されてしまいます。結果として、今回のように意図しない課金が発生しまいました。

請求された約30ドルは、勉強のための費用だと思っておきます。

# 参考リンク（SageMakerの多額請求系）
多額請求された系のブログ記事へのリンクです。これからSageMakerを使い始める人は見ておくと参考になると思います。

みなさん、数万円~十万円規模の課金がされているみたいです（かなり罠だと思います）：
- https://qiita.com/jp7eph/items/5d4b10fcdd56371b0e0f
- https://gajumarusdgs.hatenablog.com/entry/2023/03/19/235715
- https://qiita.com/ahoyousan/items/f910e997c2b931a020b0