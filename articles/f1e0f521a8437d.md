---
title: "SageMakerで請求が止まらない罠:
\"Amazon SageMaker CreateVolume-Gp3\""
emoji: "👌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS", "SageMaker"]
published: true
---
# 概要
**2025/03/02追記:
当初の記載に誤りがあったため修正しました（詳細は「修正履歴」セクション参照）。
「修正履歴」のセクションを新設**

SageMakerを利用していたときに、身に覚えのない課金に困ったので、その体験を共有します。この後に請求書の詳細を記載しますが、約14ドル/月の請求がされてしまいました。

状況としては以下の通りです：

- SageMakerを利用（ハンズオン）していた。
- その後、リソースを削除または停止した。
- AWSからの請求が止まらず困った。

簡単に言うと、以下の2点で注意が必要です。
1. **notebookインスタンスを停止しても、請求は止まらない**
2. **SageMakerのドメインを消しても、残ったままのサービスがある**[^1]

なお、SageMaker関連で多額（数万円~十万円）の請求がされた話は、色々な方が経験しているようです。一方で本記事では、"リソースを消したつもりなのに請求が止まらない"状況に絞って記載しています（本記事の最後に、多額請求系の記事へのリンクも載せておきます。）

私の場合は、合計で30ドルほど[^7]無駄な課金となってしまいました…

[^1]: 2024/02/09時点の仕様。ストレージ関連のサービスが残ってしまうため、使用内容によっては課金が発生する可能性があります（筆者の場合は、実際に課金にはつながらなかったです）。やや不親切な仕様なので、いずれ修正されるかもしれません。
[^7]: 原因はストレージ（保存した容量ベース）への課金です。そのため、筆者の場合は30ドルでしたが、人それぞれ請求額は異なるはずです。


## 修正履歴
**2/9に本記事を公開したのですが、記載間違い[^5]がありましたので、修正しています。誤った内容を公開してしまい申し訳ありません。なお、以前の記事の内容でも、（本記事と原因が同じであれば）請求は止まることに変わりはありません。**

[^5]: リソースを削除したつもりが、そもそも削除していなかった（つまり請求が止まらないのは当然）という状況で、記事を書いてしまいました。記載間違いというか、初歩的な勘違い（おそらくリージョンを間違えていました）が原因です。

前提部分の勘違いだったため、大幅に修正しています。主な変更点は以下です：
- 2025/02/09 初版: 請求書の「Amazon SageMaker CreateVolume-Gp3」は、EFSがあることが原因と記載していました。
- 2025/03/02 修正: 請求書の「Amazon SageMaker CreateVolume-Gp3」は、notebookインスタンスのMLストレージが原因であるとして内容を修正しています。

# 対象読者

- SageMakerを使ってみたら、不明な課金が止まらない人

# 結論
本記事では、SageMakerのリソースを削除しても請求が続くケースについて説明します。
まとめると、以下の2つの点が重要です：

- notebookインスタンスを停止しても、請求は止まらない
   - MLストレージが残るため、継続的に課金される。
   - 解決策: notebookインスタンスを削除する。
- SageMakerのドメインを削除しても、他のサービスが残る
   - S3, CloudWatch, EFSなどが残る可能性がある。
   - 解決策: 手動で削除する。

なお、課金の原因が同じとは限らないため、**最終的に課金が止まったことを確認すること**を強く推奨します。

## notebookインスタンスを停止しても、請求は止まらない
請求書の内容は以下の通りです。

> |説明|使用量|金額 USD|
> |--|--|--|
> |Amazon SageMaker CreateVolume-Gp3||USD 14.11|
> |$0.1344 per GB-Mo of provisioned ML storage| 105 GB-Mo|USD 14.11|

![invoice_sagemaker](/images/invoice_sagemaker.png)

~~上記の請求は、**Amazon EFS（Elastic File System）**[^2]に対する請求です。~~
~~消し方は簡単で、AWSのマネジメントコンソール > EFSの管理画面で、EFSの削除ができます。EFSや削除方法の詳細は、以下の公式ページを参照ください：~~
~~https://docs.aws.amazon.com/ja_jp/efs/latest/ug/delete-efs-fs.html~~
~~（請求書に「EFS」と書いていないのは、なかなか罠だと思います…）~~

**2025/03/02追記
勘違いをしていた部分です。以下の通り、MLストレージというのが実際の原因でした。**

上記の請求は、notebookインスタンスに紐づく**MLストレージ**に対する請求です。
こちらはストレージに保存した容量（GB）に対する課金であり、notebookインスタンスを停止しても（削除しない限り）課金が続いてしまいます。

課金を止めるには、以下の2つの方法があります：
- notebookインスタンスのストレージに保存しているデータをすべて削除したうえで、notebookインスタンスを停止する。
- notebookインスタンスを削除する。

なお、課金を止めるのに確実なのは、**後者のnotebookインスタンスを削除する方法**です（筆者もこちらの方法で課金を止めました）。

料金体系の詳細については、以下の公式サイトをご参照ください：
> MLストレージ
> ||料金|
> |--|--|
> |汎用 (SSD) ストレージ|	USD 0.14/プロビジョンドストレージの GB-月|
https://aws.amazon.com/jp/sagemaker-ai/pricing/

[^2]: ストレージサービス。ドメインをクイックセットアップ[^3]で作成した場合に作成されている

## SageMakerのドメインを削除しても、他のサービスが残る
筆者の場合は実際の請求につながらなかったのですが、注意が必要な点です。

SageMakerのドメイン作成時（クイックセットアップ利用時）に、いくつかのサービスが自動で作成されています。それらのサービスのいくつかは、SageMakerのドメインを削除した後にも残ったままになるようです。

筆者が確認した範囲だと、以下のサービスが残ったままになっていました：
- S3バケット
- CloudWatch（Logs）
- EFS

CloudWatchは、よほど大量のデータが無ければ（無料枠があるため）課金はされないと思います。S3とEFSは、保存データ容量により課金が発生する可能性があります（料金体系については、AWSの公式サイトをご確認ください）

特に理由がなければ、全て削除しておくとよいと思います。

# 【おまけ】SageMakerの全リソース削除への道
**2025/03/02追記
元々、ドメインを削除したつもりが課金が止まらなかったという内容でした。ただそれは筆者の勘違いだったため、"全リソース削除のための手順"という内容に書き換えています（手順という意味では、内容に変更はありません）**

おまけパートです。私がSageMakerの全リソース削除した手順についてまとめます。

## 手順
基本的な流れは、以下の通りです：
1. （前提）SageMakerを使い始める
2. SageMakerのリソースを削除する
3. ドメインを削除する
4. その他のサービスを削除する

注）SageMakerはサービス数が多く、課金体系も複雑です。以下に記載する手順を試した場合にも、請求等が発生していないか等をご確認ください。

### 1. （前提）SageMakerを使い始める。
前提として以下のようなケースを想定しています：
- ハンズオンをするために、SageMakerを使い始める
  - 最初にドメインを作成する（クイックセットアップ[^3]を利用する想定）
  - SageMaker Studio, Canvas, Notebookを使用する。

[^3]:https://docs.aws.amazon.com/ja_jp/sagemaker/latest/dg/onboard-quick-start.html

### 2. SageMakerのリソースを削除する
ここでは、特に注意の必要なものを中心に説明します。不要になったリソースはすぐに削除しておくと安全です。

以下のリソースは不要になったら**すぐに**削除することをおすすめします：

- トレーニングジョブや推論エンドポイント
  - ドメインの詳細画面の「リソース」タブから確認できます。
  - ちなみに、これらは比較的料金が高いです。高額請求された話は、このリソース関連が大半だと思います。
- notebookインスタンス
  - 本記事の前半の通りです。使う予定がなければ削除することをお勧めします。

### 3. ドメインを削除する
これ以上SageMakerを使わないのであれば、ドメインの削除を実施するとよいです。以下の手順でドメインを削除していきます。

- ユーザープロファイルを削除する
  - これを消さないと「ドメインを削除」ボタンが押せないため、削除が必要です。
- ドメインを削除する
  - ドメインの詳細ページの中ほどに「ドメインを削除」ボタンがあります。

注）ドメインに紐づくリソースがあると、ドメインを削除できないようです。もし、「ドメインを削除」ボタンが押せない場合は、他に残っているリソースがないかを確認してください（筆者の場合は、ユーザープロファイルの削除をすれば、ドメインを削除できました）

### 4. その他のサービスを削除する
最後に、SageMaker関連のリソースが残っていないか確認して、不要なものがあれば削除していきます。

筆者が確認した範囲では、以下のリソースが残っていました：
- S3バケット
- CloudWatch（Logs）
- EFS

上記は、不要であれば削除しておくことをおすすめします。

### 5. 最終確認
最後に念押しとして、請求書を確認して、意図しない請求が発生していないかを確認しましょう！
なお、AWSの請求書は1日~2日程度のラグがあるためご注意ください。

# まとめ
本記事では、SageMakerを使用後に「なぜか請求が止まらない」問題を解説しました。
原因は notebookインスタンスのMLストレージが削除されていなかったことでした。

SageMakerのリソースは自動で多数作成されるため、課金を避けるには以下が重要です。
* notebookインスタンスは「停止」ではなく「削除」する
* ドメインを削除しても、EFSやS3が残っていないか確認する

AWSの料金体系は複雑ですが、しっかりチェックして無駄な課金を防ぎましょう！

# 参考リンク（SageMakerの多額請求系）
多額請求された系のブログ記事へのリンクです。これからSageMakerを使い始める人は見ておくと参考になると思います。

みなさん、数万円~十万円規模の課金がされているみたいです（かなり罠だと思います）：
- https://qiita.com/jp7eph/items/5d4b10fcdd56371b0e0f
- https://gajumarusdgs.hatenablog.com/entry/2023/03/19/235715
- https://qiita.com/ahoyousan/items/f910e997c2b931a020b0